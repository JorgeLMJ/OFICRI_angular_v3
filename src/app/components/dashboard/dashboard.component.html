<style>
  /* Indicador lateral para el menú activo */
  .active-link .active-indicator {
    transform: translateX(0) !important;
  }

  .active-link i {
    color: #ffffff !important;
  }

  /* Scrollbar personalizada */
  .custom-scrollbar::-webkit-scrollbar {
    width: 5px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: #1e3a8a;
    border-radius: 10px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: #2563eb;
  }

  /* Header compacto con Glassmorphism */
  header {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    background-color: rgba(30, 58, 138, 0.85) !important;
    /* Reducimos la altura mínima para asegurar el achatado */
    height: 75px; 
  }

  .active-indicator {
    transition: transform 0.2s ease-in-out;
  }
</style>

<div class="flex h-screen bg-slate-50 overflow-hidden font-sans">

  <aside 
    class="bg-blue-950 text-blue-100 w-72 transition-all duration-300 ease-in-out z-50 fixed inset-y-0 left-0 shadow-2xl flex flex-col"
    [class]="innerWidth >= 992 ? (isMenuOpen ? 'translate-x-0' : '-translate-x-full') : '-translate-x-full'">

    <div class="p-6 flex items-center space-x-3 bg-blue-900/40">
      <div class="p-2 bg-blue-500 rounded-lg shadow-lg shadow-blue-400/30">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="white"/>
          <path d="M2 17L12 22L22 17" />
          <path d="M2 12L12 17L22 12" />
        </svg>
      </div>
      <span class="font-extrabold text-xl tracking-tight text-white">OFICRI</span>
    </div>

    <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto custom-scrollbar">
      <div *ngFor="let item of filteredMenuItems">
        <a 
          [routerLink]="item.route"
          routerLinkActive="active-link bg-blue-700 text-white shadow-inner"
          [routerLinkActiveOptions]="{exact: item.route === '/dashboard'}"
          class="group flex items-center px-4 py-3 rounded-xl transition-all duration-200 hover:bg-blue-800/50 hover:text-white relative overflow-hidden text-blue-200">
          
          <div class="active-indicator absolute left-0 w-1.5 h-6 bg-cyan-400 rounded-r-full transform -translate-x-full transition-transform"></div>
          
          <i class="bi {{ item.icon }} text-xl mr-4 group-hover:scale-110 transition-transform"></i>
          <span class="font-medium text-sm">{{ item.title }}</span>
        </a>
      </div>
    </nav>

    <div class="p-4 bg-blue-900/20 border-t border-blue-800/50">
      <button 
        class="w-full group bg-blue-900/40 hover:bg-red-600/20 hover:text-red-400 text-blue-300 py-3 px-4 rounded-xl flex items-center justify-center transition-all duration-300 border border-blue-800 hover:border-red-500/50"
        (click)="logout()">
        <i class="bi bi-box-arrow-right mr-3 text-lg group-hover:translate-x-1 transition-transform"></i>
        <span class="font-bold text-sm text-white">Cerrar Sesión</span>
      </button>
    </div>
  </aside>

  <main class="flex-1 flex flex-col h-screen transition-all duration-300 ease-in-out relative" 
        [class]="innerWidth >= 992 ? (isMenuOpen ? 'ml-72' : 'ml-0') : 'ml-0'">

    <header *ngIf="isHeaderVisible" class="border-b border-blue-800/30 px-6 py-2 flex items-center justify-between z-40 sticky top-0 text-white">
      
      <div class="flex items-center space-x-4">
        <button 
          class="p-1.5 rounded-lg bg-blue-800/30 hover:bg-blue-700/50 text-white transition-colors"
          (click)="toggleMenu()">
          <i class="bi bi-list text-xl"></i>
        </button>
        <h1 class="hidden md:block font-bold text-base text-blue-50">{{ getCurrentPageTitle() }}</h1>
      </div>

      <div class="flex items-center space-x-3">
        <a class="relative p-1.5 rounded-full bg-blue-800/30 hover:bg-blue-700/50 text-blue-100 transition-all border border-blue-700/30" 
           routerLink="/dashboard/notificaciones">
          <i class="bi bi-bell text-lg"></i>
          <span class="absolute top-1 right-1 flex h-3.5 w-3.5" *ngIf="unreadCount > 0">
            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
            <span class="relative inline-flex rounded-full h-3.5 w-3.5 bg-red-600 text-[8px] items-center justify-center text-white font-bold">{{ unreadCount }}</span>
          </span>
        </a>

        <div class="flex items-center space-x-3 pl-3 border-l border-blue-700/50 ml-1">
          <div class="hidden sm:flex flex-col items-end text-right leading-tight">
            <span class="text-xs font-bold text-white">{{ userName }}</span>
            <span class="text-[9px] text-blue-200 font-medium uppercase tracking-wider">{{ currentRole }}</span>
          </div>
          <div class="h-8 w-8 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold border border-blue-400 shadow-md">
            {{ userName.charAt(0).toUpperCase() }}
          </div>
        </div>
      </div>
    </header>

    <section class="flex-1 overflow-y-auto bg-slate-50 custom-scrollbar">
      <div class="p-6 md:p-8">
        <router-outlet></router-outlet>
      </div>
    </section>

  </main>
</div>

<div class="offcanvas offcanvas-start bg-blue-950 text-blue-100 w-80 border-none shadow-2xl" tabindex="-1" id="offcanvasMenu">
  <div class="offcanvas-header bg-blue-900 p-4">
    <div class="flex items-center space-x-3">
      <div class="p-2 bg-blue-500 rounded-lg">
        <i class="bi bi-shield-check text-white"></i>
      </div>
      <h5 class="offcanvas-title text-white font-bold tracking-tight" id="offcanvasMenuLabel">SISTEMA OFICRI</h5>
    </div>
    <button type="button" class="btn-close btn-close-white scale-75 shadow-none" data-bs-dismiss="offcanvas"></button>
  </div>
  
  <div class="offcanvas-body p-4 pt-6 flex flex-col bg-blue-950">
    <ul class="space-y-2 flex-1">
      <li *ngFor="let item of filteredMenuItems">
        <a 
          class="flex items-center px-4 py-3 rounded-xl text-blue-200 hover:bg-blue-700 hover:text-white transition-all border border-transparent"
          [routerLink]="item.route"
          data-bs-dismiss="offcanvas">
          <i class="bi {{ item.icon }} text-lg mr-4"></i> 
          <span class="font-semibold text-sm">{{ item.title }}</span>
        </a>
      </li>
    </ul>

    <button 
      class="mt-auto w-full bg-red-600/20 hover:bg-red-600 text-red-400 hover:text-white py-3 px-4 rounded-2xl flex items-center justify-center transition-all duration-300 border border-red-500/30 mb-2"
      (click)="logout()" 
      data-bs-dismiss="offcanvas">
      <i class="bi bi-box-arrow-right mr-3 text-lg"></i>
      <span class="font-bold text-sm">Cerrar Sesión</span>
    </button>
  </div>
</div>